{"remainingRequest":"D:\\code\\willFire\\vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\willFire\\vue\\src\\components\\comment\\graffiti.vue?vue&type=style&index=0&id=4aa9de88&scoped=true&lang=css&","dependencies":[{"path":"D:\\code\\willFire\\vue\\src\\components\\comment\\graffiti.vue","mtime":1723964853960},{"path":"D:\\code\\willFire\\vue\\node_modules\\css-loader\\dist\\cjs.js","mtime":1723800259430},{"path":"D:\\code\\willFire\\vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1723800260168},{"path":"D:\\code\\willFire\\vue\\node_modules\\postcss-loader\\src\\index.js","mtime":1723800259734},{"path":"D:\\code\\willFire\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1723800259159},{"path":"D:\\code\\willFire\\vue\\node_modules\\vue-loader\\lib\\index.js","mtime":1723800259896}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouZ3JhZmZpdGktY29udGFpbmVyIHsKICBvdmVyZmxvdzogaGlkZGVuOwogIGJvcmRlcjogMnB4IHZhcigtLWxpZ2h0R3JheSkgc29saWQ7CiAgYm9yZGVyLXJhZGl1czogNHB4Owp9CgouZ3JhZmZpdGktdG9vbHMgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBtYXJnaW4tYm90dG9tOiAxMHB4Owp9CgouZ3JhZmZpdGktdGl0bGUgewogIGZvbnQtc2l6ZTogMTRweDsKfQoKLmdyYWZmaXRpLWNvbG9yIHsKICB3aWR0aDogMXJlbTsKICBoZWlnaHQ6IDFyZW07CiAgYm9yZGVyLXJhZGl1czogNTAlOwogIGZsb2F0OiBsZWZ0OwogIG1hcmdpbi1yaWdodDogMjBweDsKICBjdXJzb3I6IHBvaW50ZXI7CiAgdHJhbnNpdGlvbjogYWxsIDAuMnM7Cn0KCi5ncmFmZml0aS1jb2xvcjpob3ZlciB7CiAgd2lkdGg6IDEuM3JlbTsKICBoZWlnaHQ6IDEuM3JlbTsKfQoKLmFjdGl2ZUNvbG9yIHsKICB3aWR0aDogMS4zcmVtOwogIGhlaWdodDogMS4zcmVtOwp9CgouZ3JhZmZpdGktc2l6ZSB7CiAgY3Vyc29yOiBwb2ludGVyOwogIG1hcmdpbi1yaWdodDogMjBweDsKfQoKLmdyYWZmaXRpLXNpemUuc21hbGwgewogIGZvbnQtc2l6ZTogMTRweDsKfQoKLmdyYWZmaXRpLXNpemUubWlkZGxlIHsKICBmb250LXNpemU6IDE2cHg7Cn0KCi5ncmFmZml0aS1zaXplLmJpZyB7CiAgZm9udC1zaXplOiAxOHB4Owp9CgouYWN0aXZlU2l6ZSB7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tdGhlbWVCYWNrZ3JvdW5kKTsKICBjb2xvcjogdmFyKC0td2hpdGUpOwogIGJvcmRlci1yYWRpdXM6IDUwJTsKICBwYWRkaW5nOiAycHg7Cn0KCi5ncmFmZml0aS1vcGVyYXRlIHsKICBtYXJnaW4tcmlnaHQ6IDIwcHg7CiAgY3Vyc29yOiBwb2ludGVyOwogIGZvbnQtc2l6ZTogMThweDsKfQoKLmdyYWZmaXRpLW9wZXJhdGUuYmFuIHsKICBjdXJzb3I6IG5vdC1hbGxvd2VkCn0K"},{"version":3,"sources":["graffiti.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkVA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"graffiti.vue","sourceRoot":"src/components/comment","sourcesContent":["<template>\n  <div>\n    <!-- 画布 -->\n    <div style=\"padding: 5px\" @mousemove=\"canvasOutMove($event)\" @touchmove=\"canvasOutMove($event)\">\n      <div class=\"graffiti-container\">\n        <canvas id=\"canvas\"\n                width=\"766\"\n                height=\"400\"\n                @mousedown=\"canvasDown($event)\"\n                @mouseup=\"canvasUp($event)\"\n                @mousemove=\"canvasMove($event)\"\n                @touchstart=\"canvasDown($event)\"\n                @touchend=\"canvasUp($event)\"\n                @touchmove=\"canvasMove($event)\">\n        </canvas>\n      </div>\n    </div>\n\n    <div style=\"padding: 10px 0 0 5px;\">\n      <!-- 颜色 -->\n      <div class=\"graffiti-tools\">\n        <span class=\"graffiti-title\">画笔颜色</span>\n        <div class=\"myCenter\" style=\"margin-left: 2rem\">\n          <div v-for=\"(color, index) in colors\"\n               :class=\"{ activeColor: config.lineColor === color }\"\n               :style=\"{ background: color }\"\n               @click=\"setColor(color)\"\n               class=\"graffiti-color\"\n               :key=\"index\">\n          </div>\n        </div>\n      </div>\n\n      <!-- 大小 -->\n      <div class=\"graffiti-tools\">\n        <span class=\"graffiti-title\">画笔大小</span>\n        <div class=\"myCenter\" style=\"margin-left: 2rem\">\n          <i v-for=\"(pen, index) in brushSize\"\n             :key=\"index\"\n             class=\"graffiti-size\"\n             :class=\"[pen.className, { activeSize: config.lineWidth === pen.lineWidth }]\"\n             @click=\"setBrush(pen.lineWidth)\">\n          </i>\n        </div>\n      </div>\n\n      <!-- 操作 -->\n      <div class=\"graffiti-tools\">\n        <span class=\"graffiti-title\">操作</span>\n        <div class=\"myCenter\" style=\"margin-left: 3.7rem\">\n          <i v-for=\"(control, index) in controls\"\n             :title=\"control.title\"\n             :class=\"control.className\"\n             class=\"graffiti-operate\"\n             @click=\"controlCanvas(control.action)\"\n             :key=\"index\">\n          </i>\n        </div>\n      </div>\n\n      <!-- 按钮 -->\n      <div class=\"graffiti-tools\" style=\"justify-content: center\">\n        <proButton :info=\"'文字'\"\n                   @click.native=\"showComment()\"\n                   :before=\"$constant.before_color_1\"\n                   :after=\"$constant.after_color_1\"\n                   style=\"margin-right: 6px\">\n        </proButton>\n        <proButton :info=\"'提交'\"\n                   @click.native=\"getImage()\"\n                   :before=\"$constant.before_color_2\"\n                   :after=\"$constant.after_color_2\">\n        </proButton>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n  const proButton = () => import( \"../common/proButton\");\n\n  export default {\n    components: {\n      proButton\n    },\n    data() {\n      return {\n        context: {},\n        canvasMoveUse: false,\n        // 存储当前表面状态数组-上一步\n        preDrawAry: [],\n        // 存储当前表面状态数组-下一步\n        nextDrawAry: [],\n        // 中间数组\n        middleAry: [],\n        // 配置参数\n        config: {\n          lineWidth: 5,\n          lineColor: \"#8154A3\",\n          shadowBlur: 2,\n        },\n        colors: [\"#8154A3\", \"#fef4ac\", \"#0018ba\", \"#ffc200\", \"#f32f15\", \"#cccccc\", \"#5ab639\"],\n        brushSize: [{\n          className: \"small el-icon-edit\",\n          lineWidth: 5,\n        }, {\n          className: \"middle el-icon-edit\",\n          lineWidth: 10,\n        }, {\n          className: \"big el-icon-edit\",\n          lineWidth: 15,\n        }]\n      };\n    },\n    computed: {\n      controls() {\n        return [{\n          title: \"上一步\",\n          action: \"prev\",\n          className: this.preDrawAry.length\n            ? \"active el-icon-arrow-left\"\n            : \"ban el-icon-arrow-left\",\n        }, {\n          title: \"下一步\",\n          action: \"next\",\n          className: this.nextDrawAry.length\n            ? \"active el-icon-arrow-right\"\n            : \"ban el-icon-arrow-right\",\n        }, {\n          title: \"清除\",\n          action: \"clear\",\n          className:\n            this.preDrawAry.length || this.nextDrawAry.length\n              ? \"active el-icon-refresh\"\n              : \"ban el-icon-refresh\",\n        }];\n      }\n    },\n    mounted() {\n      const canvas = document.querySelector(\"#canvas\");\n      this.context = canvas.getContext(\"2d\", {willReadFrequently: true});\n      this.initDraw();\n      this.setCanvasStyle();\n    },\n    created() {\n    },\n    methods: {\n      canvasOutMove(e) {\n        const canvas = document.querySelector(\"#canvas\");\n        if (e.target !== canvas) {\n          this.canvasMoveUse = false;\n        }\n      },\n      initDraw() {\n        const preData = this.context.getImageData(0, 0, 1200, 600);\n        // 空绘图表面进栈\n        this.middleAry.push(preData);\n      },\n      canvasUp(e) {\n        const preData = this.context.getImageData(0, 0, 1200, 600);\n        if (!this.nextDrawAry.length) {\n          // 当前绘图表面进栈\n          this.middleAry.push(preData);\n        } else {\n          this.middleAry = [];\n          this.middleAry = this.middleAry.concat(this.preDrawAry);\n          this.middleAry.push(preData);\n          this.nextDrawAry = [];\n        }\n        this.canvasMoveUse = false;\n        this.context.beginPath();\n      },\n      canvasDown(e) {\n        this.canvasMoveUse = true;\n        // client是基于整个页面的坐标\n        // offset是canvas距离顶部以及左边的距离\n        this.setCanvasStyle();\n        // 清除子路径\n        this.context.beginPath();\n        this.context.moveTo(e.layerX, e.layerY);\n        // 当前绘图表面状态\n        const preData = this.context.getImageData(0, 0, 1200, 600);\n        // 当前绘图表面进栈\n        this.preDrawAry.push(preData);\n      },\n      canvasMove(e) {\n        if (this.canvasMoveUse) {\n          this.context.lineTo(e.layerX, e.layerY);\n          this.context.stroke();\n        }\n      },\n      // 设置绘画配置\n      setCanvasStyle() {\n        this.context.lineWidth = this.config.lineWidth;\n        this.context.shadowBlur = this.config.shadowBlur;\n        this.context.shadowColor = this.config.lineColor;\n        this.context.strokeStyle = this.config.lineColor;\n      },\n      // 设置颜色\n      setColor(color) {\n        this.config.lineColor = color;\n      },\n      // 设置笔刷大小\n      setBrush(size) {\n        this.config.lineWidth = size;\n      },\n      controlCanvas(action) {\n        switch (action) {\n          case \"prev\":\n            if (this.preDrawAry.length) {\n              const popData = this.preDrawAry.pop();\n              const midData = this.middleAry[this.preDrawAry.length + 1];\n              this.nextDrawAry.push(midData);\n              this.context.putImageData(popData, 0, 0);\n            }\n            break;\n          case \"next\":\n            if (this.nextDrawAry.length) {\n              const popData = this.nextDrawAry.pop();\n              const midData = this.middleAry[this.middleAry.length - this.nextDrawAry.length - 2];\n              this.preDrawAry.push(midData);\n              this.context.putImageData(popData, 0, 0);\n            }\n            break;\n          case \"clear\":\n            this.clearContext();\n            this.middleAry = [this.middleAry[0]];\n            break;\n        }\n      },\n      clearContext() {\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\n        this.preDrawAry = [];\n        this.nextDrawAry = [];\n      },\n      showComment() {\n        this.clearContext();\n        this.$emit(\"showComment\");\n      },\n      getImage() {\n        if (this.$common.isEmpty(this.$store.state.currentUser)) {\n          this.$message({\n            message: \"请先登录！\",\n            type: \"error\"\n          });\n          return;\n        }\n\n        if (this.preDrawAry.length < 1) {\n          this.$message({\n            message: \"你还没画呢~\",\n            type: \"warning\"\n          });\n          return;\n        }\n\n        const canvas = document.querySelector(\"#canvas\");\n        const dataURL = canvas.toDataURL(\"image/png\");\n        let arr = dataURL.split(\",\"),\n          mine = arr[0].match(/:(.*?);/)[1],\n          str = atob(arr[1]),\n          n = str.length,\n          u8arr = new Uint8Array(n);\n        while (n--) {\n          u8arr[n] = str.charCodeAt(n);\n        }\n        let obj = new Blob([u8arr], {type: mine});\n        let key = \"graffiti\" + \"/\" + this.$store.state.currentUser.username.replace(/[^a-zA-Z]/g, '') + this.$store.state.currentUser.id + new Date().getTime() + Math.floor(Math.random() * 1000) + \".png\";\n\n        let storeType = localStorage.getItem(\"defaultStoreType\");\n\n        let fd = new FormData();\n        fd.append(\"file\", obj);\n        fd.append(\"key\", key);\n        fd.append(\"relativePath\", key);\n        fd.append(\"type\", \"graffiti\");\n        fd.append(\"storeType\", storeType);\n\n        if (storeType === \"local\") {\n          this.saveLocal(fd);\n        } else if (storeType === \"qiniu\") {\n          this.saveQiniu(fd);\n        }\n      },\n      saveLocal(fd) {\n        this.$http.upload(\"http://47.96.86.223:8081/api\" + \"/resource/upload\", fd)\n          .then((res) => {\n            if (!this.$common.isEmpty(res.data)) {\n              this.clearContext();\n              let url = res.data;\n              let img = \"[你画我猜,\" + url + \"]\";\n              this.$emit(\"addGraffitiComment\", img);\n            }\n          })\n          .catch((error) => {\n            this.$message({\n              message: error.message,\n              type: \"error\"\n            });\n          });\n      },\n      saveQiniu(fd) {\n        this.$http.get(\"http://47.96.86.223:8081/api\" + \"/qiniu/getUpToken\", {key: fd.get(\"key\")})\n          .then((res) => {\n            if (!this.$common.isEmpty(res.data)) {\n              fd.append(\"token\", res.data);\n\n              this.$http.uploadQiniu(this.$store.state.sysConfig.qiniuUrl, fd)\n                .then((res) => {\n                  if (!this.$common.isEmpty(res.key)) {\n                    this.clearContext();\n                    let url = this.$store.state.sysConfig['qiniu.downloadUrl'] + res.key;\n                    let file = fd.get(\"file\");\n                    this.$common.saveResource(this, \"graffiti\", url, file.size, file.type, null, \"qiniu\");\n                    let img = \"[你画我猜,\" + url + \"]\";\n                    this.$emit(\"addGraffitiComment\", img);\n                  }\n                })\n                .catch((error) => {\n                  this.$message({\n                    message: error.message,\n                    type: \"error\"\n                  });\n                });\n            }\n          })\n          .catch((error) => {\n            this.$message({\n              message: error.message,\n              type: \"error\"\n            });\n          });\n      }\n    }\n  }\n</script>\n\n<style scoped>\n  .graffiti-container {\n    overflow: hidden;\n    border: 2px var(--lightGray) solid;\n    border-radius: 4px;\n  }\n\n  .graffiti-tools {\n    display: flex;\n    align-items: center;\n    margin-bottom: 10px;\n  }\n\n  .graffiti-title {\n    font-size: 14px;\n  }\n\n  .graffiti-color {\n    width: 1rem;\n    height: 1rem;\n    border-radius: 50%;\n    float: left;\n    margin-right: 20px;\n    cursor: pointer;\n    transition: all 0.2s;\n  }\n\n  .graffiti-color:hover {\n    width: 1.3rem;\n    height: 1.3rem;\n  }\n\n  .activeColor {\n    width: 1.3rem;\n    height: 1.3rem;\n  }\n\n  .graffiti-size {\n    cursor: pointer;\n    margin-right: 20px;\n  }\n\n  .graffiti-size.small {\n    font-size: 14px;\n  }\n\n  .graffiti-size.middle {\n    font-size: 16px;\n  }\n\n  .graffiti-size.big {\n    font-size: 18px;\n  }\n\n  .activeSize {\n    background-color: var(--themeBackground);\n    color: var(--white);\n    border-radius: 50%;\n    padding: 2px;\n  }\n\n  .graffiti-operate {\n    margin-right: 20px;\n    cursor: pointer;\n    font-size: 18px;\n  }\n\n  .graffiti-operate.ban {\n    cursor: not-allowed\n  }\n</style>\n"]}]}