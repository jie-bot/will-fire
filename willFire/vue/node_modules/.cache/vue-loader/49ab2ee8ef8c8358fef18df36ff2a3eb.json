{"remainingRequest":"D:\\code\\willFire\\vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\willFire\\vue\\src\\components\\common\\uploadPicture.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code\\willFire\\vue\\src\\components\\common\\uploadPicture.vue","mtime":1723964853960},{"path":"D:\\code\\willFire\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1723800259159},{"path":"D:\\code\\willFire\\vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1723800259743},{"path":"D:\\code\\willFire\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1723800259159},{"path":"D:\\code\\willFire\\vue\\node_modules\\vue-loader\\lib\\index.js","mtime":1723800259896}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB1cGxvYWQgZnJvbSAnLi4vLi4vdXRpbHMvYWpheFVwbG9hZCc7CgpleHBvcnQgZGVmYXVsdCB7CiAgcHJvcHM6IHsKICAgIGlzQWRtaW46IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICBwcmVmaXg6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAiIgogICAgfSwKICAgIGxpc3RUeXBlOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogInBpY3R1cmUiCiAgICB9LAogICAgc3RvcmVUeXBlOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogbG9jYWxTdG9yYWdlLmdldEl0ZW0oImRlZmF1bHRTdG9yZVR5cGUiKQogICAgfSwKICAgIGFjY2VwdDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICJpbWFnZS8qIgogICAgfSwKICAgIG1heFNpemU6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiA1CiAgICB9LAogICAgbWF4TnVtYmVyOiB7CiAgICAgIHR5cGU6IE51bWJlciwKICAgICAgZGVmYXVsdDogNQogICAgfQogIH0sCgogIGRhdGEoKSB7CiAgICByZXR1cm4ge30KICB9LAoKICBjb21wdXRlZDoge30sCgogIHdhdGNoOiB7fSwKCiAgY3JlYXRlZCgpIHsKICB9LAoKICBtb3VudGVkKCkgewoKICB9LAoKICBtZXRob2RzOiB7CiAgICBzdWJtaXRVcGxvYWQoKSB7CiAgICAgIHRoaXMuJHJlZnMudXBsb2FkLnN1Ym1pdCgpOwogICAgfSwKCiAgICBjdXN0b21VcGxvYWQob3B0aW9ucykgewogICAgICBsZXQgc3VmZml4ID0gIiI7CiAgICAgIGlmIChvcHRpb25zLmZpbGUubmFtZS5sYXN0SW5kZXhPZignLicpICE9PSAtMSkgewogICAgICAgIHN1ZmZpeCA9IG9wdGlvbnMuZmlsZS5uYW1lLnN1YnN0cmluZyhvcHRpb25zLmZpbGUubmFtZS5sYXN0SW5kZXhPZignLicpKTsKICAgICAgfQoKICAgICAgbGV0IGtleSA9IHRoaXMucHJlZml4ICsgIi8iICsgKCF0aGlzLiRjb21tb24uaXNFbXB0eSh0aGlzLiRzdG9yZS5zdGF0ZS5jdXJyZW50VXNlci51c2VybmFtZSkgPyAodGhpcy4kc3RvcmUuc3RhdGUuY3VycmVudFVzZXIudXNlcm5hbWUucmVwbGFjZSgvW15hLXpBLVpdL2csICcnKSArIHRoaXMuJHN0b3JlLnN0YXRlLmN1cnJlbnRVc2VyLmlkKSA6ICh0aGlzLiRzdG9yZS5zdGF0ZS5jdXJyZW50QWRtaW4udXNlcm5hbWUucmVwbGFjZSgvW15hLXpBLVpdL2csICcnKSArIHRoaXMuJHN0b3JlLnN0YXRlLmN1cnJlbnRBZG1pbi5pZCkpICsgbmV3IERhdGUoKS5nZXRUaW1lKCkgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwKSArIHN1ZmZpeDsKCiAgICAgIGlmICh0aGlzLnN0b3JlVHlwZSA9PT0gImxvY2FsIikgewogICAgICAgIGxldCBmZCA9IG5ldyBGb3JtRGF0YSgpOwogICAgICAgIGZkLmFwcGVuZCgiZmlsZSIsIG9wdGlvbnMuZmlsZSk7CiAgICAgICAgZmQuYXBwZW5kKCJvcmlnaW5hbE5hbWUiLCBvcHRpb25zLmZpbGUubmFtZSk7CiAgICAgICAgZmQuYXBwZW5kKCJrZXkiLCBrZXkpOwogICAgICAgIGZkLmFwcGVuZCgicmVsYXRpdmVQYXRoIiwga2V5KTsKICAgICAgICBmZC5hcHBlbmQoInR5cGUiLCB0aGlzLnByZWZpeCk7CiAgICAgICAgZmQuYXBwZW5kKCJzdG9yZVR5cGUiLCB0aGlzLnN0b3JlVHlwZSk7CgogICAgICAgIHJldHVybiB0aGlzLiRodHRwLnVwbG9hZCgiaHR0cDovLzQ3Ljk2Ljg2LjIyMzo4MDgxL2FwaSIgKyAiL3Jlc291cmNlL3VwbG9hZCIsIGZkLCB0aGlzLmlzQWRtaW4sIG9wdGlvbnMpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuc3RvcmVUeXBlID09PSAicWluaXUiKSB7CiAgICAgICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgeGhyLm9wZW4oJ2dldCcsICJodHRwOi8vNDcuOTYuODYuMjIzOjgwODEvYXBpIiArICIvcWluaXUvZ2V0VXBUb2tlbj9rZXk9IiArIGtleSwgZmFsc2UpOwogICAgICAgIGlmICh0aGlzLmlzQWRtaW4pIHsKICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCJBdXRob3JpemF0aW9uIiwgbG9jYWxTdG9yYWdlLmdldEl0ZW0oImFkbWluVG9rZW4iKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCJBdXRob3JpemF0aW9uIiwgbG9jYWxTdG9yYWdlLmdldEl0ZW0oInVzZXJUb2tlbiIpKTsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICB4aHIuc2VuZCgpOwogICAgICAgICAgY29uc3QgcmVzID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTsKICAgICAgICAgIGlmIChyZXMgIT09IG51bGwgJiYgcmVzLmhhc093blByb3BlcnR5KCJjb2RlIikgJiYgcmVzLmNvZGUgPT09IDIwMCkgewogICAgICAgICAgICBvcHRpb25zLmRhdGEgPSB7CiAgICAgICAgICAgICAgdG9rZW46IHJlcy5kYXRhLAogICAgICAgICAgICAgIGtleToga2V5CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiB1cGxvYWQob3B0aW9ucyk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlcyAhPT0gbnVsbCAmJiByZXMuaGFzT3duUHJvcGVydHkoImNvZGUiKSAmJiByZXMuY29kZSAhPT0gMjAwKSB7CiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChyZXMubWVzc2FnZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoIuacjeWKoeW8guW4uO+8gSIpOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlLm1lc3NhZ2UpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvLyDmlofku7bkuIrkvKDmiJDlip/ml7bnmoTpkqnlrZAKICAgIGhhbmRsZVN1Y2Nlc3MocmVzcG9uc2UsIGZpbGUsIGZpbGVMaXN0KSB7CiAgICAgIGxldCB1cmw7CiAgICAgIGlmICh0aGlzLnN0b3JlVHlwZSA9PT0gImxvY2FsIikgewogICAgICAgIHVybCA9IHJlc3BvbnNlLmRhdGE7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5zdG9yZVR5cGUgPT09ICJxaW5pdSIpIHsKICAgICAgICB1cmwgPSB0aGlzLiRzdG9yZS5zdGF0ZS5zeXNDb25maWdbJ3Fpbml1LmRvd25sb2FkVXJsJ10gKyByZXNwb25zZS5rZXk7CiAgICAgICAgdGhpcy4kY29tbW9uLnNhdmVSZXNvdXJjZSh0aGlzLCB0aGlzLnByZWZpeCwgdXJsLCBmaWxlLnNpemUsIGZpbGUucmF3LnR5cGUsIGZpbGUubmFtZSwgInFpbml1IiwgdGhpcy5pc0FkbWluKTsKICAgICAgfQogICAgICB0aGlzLiRlbWl0KCJhZGRQaWN0dXJlIiwgdXJsKTsKICAgIH0sCiAgICBoYW5kbGVFcnJvcihlcnIsIGZpbGUsIGZpbGVMaXN0KSB7CiAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgIG1lc3NhZ2U6IGVyciwKICAgICAgICB0eXBlOiAiZXJyb3IiCiAgICAgIH0pOwogICAgfSwKICAgIC8vIOS4iuS8oOaWh+S7tuS5i+WJjeeahOmSqeWtkO+8jOWPguaVsOS4uuS4iuS8oOeahOaWh+S7tu+8jOiLpei/lOWbniBmYWxzZSDmiJbogIXov5Tlm54gUHJvbWlzZSDkuJTooqsgcmVqZWN077yM5YiZ5YGc5q2i5LiK5LygCiAgICBiZWZvcmVVcGxvYWQoZmlsZSkgewogICAgfSwKICAgIC8vIOaWh+S7tuWIl+ihqOenu+mZpOaWh+S7tuaXtueahOmSqeWtkAogICAgaGFuZGxlUmVtb3ZlKGZpbGUsIGZpbGVMaXN0KSB7CiAgICB9LAogICAgLy8g5re75Yqg5paH5Lu244CB5LiK5Lyg5oiQ5Yqf5ZKM5LiK5Lyg5aSx6LSl5pe26YO95Lya6KKr6LCD55SoCiAgICBoYW5kbGVDaGFuZ2UoZmlsZSwgZmlsZUxpc3QpIHsKICAgICAgbGV0IGZsYWcgPSBmYWxzZTsKCiAgICAgIGlmIChmaWxlLnNpemUgPiB0aGlzLm1heFNpemUgKiAxMDI0ICogMTAyNCkgewogICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgbWVzc2FnZTogIuWbvueJh+acgOWkp+S4uiIgKyB0aGlzLm1heFNpemUgKyAiTe+8gSIsCiAgICAgICAgICB0eXBlOiAid2FybmluZyIKICAgICAgICB9KTsKICAgICAgICBmbGFnID0gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKGZsYWcpIHsKICAgICAgICBmaWxlTGlzdC5zcGxpY2UoZmlsZUxpc3Quc2l6ZSAtIDEsIDEpOwogICAgICB9CiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["uploadPicture.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmDA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"uploadPicture.vue","sourceRoot":"src/components/common","sourcesContent":["<template>\n  <div>\n    <el-upload\n      class=\"upload-demo\"\n      ref=\"upload\"\n      multiple\n      drag\n      :action=\"$store.state.sysConfig.qiniuUrl\"\n      :on-change=\"handleChange\"\n      :before-upload=\"beforeUpload\"\n      :on-success=\"handleSuccess\"\n      :on-error=\"handleError\"\n      :on-remove=\"handleRemove\"\n      :http-request=\"customUpload\"\n      :list-type=\"listType\"\n      :accept=\"accept\"\n      :limit=\"maxNumber\"\n      :auto-upload=\"false\">\n      <div class=\"el-upload__text\">\n        <svg viewBox=\"0 0 1024 1024\" width=\"40\" height=\"40\">\n          <path\n            d=\"M666.2656 629.4528l-113.7664-112.4864c-20.7872-20.5824-54.3232-20.5312-75.1104 0.1024l-113.3056 112.4864c-20.8896 20.736-21.0432 54.528-0.256 75.4688 20.736 20.8896 54.528 21.0432 75.4688 0.256l22.6304-22.4256v189.5936c0 29.44 23.9104 53.3504 53.3504 53.3504s53.3504-23.9104 53.3504-53.3504v-189.5424l22.6816 22.4256a53.1456 53.1456 0 0 0 37.5296 15.4112c13.7728 0 27.4944-5.2736 37.9392-15.8208 20.6336-20.9408 20.4288-54.7328-0.512-75.4688z\"\n            fill=\"#FFE37B\"></path>\n          <path\n            d=\"M820.992 469.504h-5.376c-3.072-163.328-136.3456-294.8096-300.4416-294.8096S217.856 306.1248 214.784 469.504H209.408c-100.7104 0-182.3744 81.664-182.3744 182.3744s81.664 182.3744 182.3744 182.3744h209.7664V761.856c-30.208 5.5808-62.464-3.3792-85.6576-26.7264-37.3248-37.5808-37.0688-98.5088 0.512-135.7824l113.3056-112.4864c37.2224-36.9664 97.8432-37.0176 135.168-0.1536l113.7664 112.4864c18.2272 18.0224 28.3648 42.0864 28.5184 67.7376 0.1536 25.6512-9.728 49.8176-27.7504 68.0448a95.40096 95.40096 0 0 1-68.3008 28.5184c-5.9392 0-11.776-0.512-17.5104-1.5872v72.3456h209.7664c100.7104 0 182.3744-81.664 182.3744-182.3744S921.7024 469.504 820.992 469.504z\"\n            fill=\"#8C7BFD\"></path>\n        </svg>\n        <div>拖拽上传 / 点击上传</div>\n      </div>\n      <template v-if=\"listType === 'picture'\">\n        <div slot=\"tip\" class=\"el-upload__tip\">\n          一次最多上传{{maxNumber}}张图片，且每张图片不超过{{maxSize}}M！\n        </div>\n      </template>\n      <template v-else>\n        <div slot=\"tip\" class=\"el-upload__tip\">\n          一次最多上传{{maxNumber}}个文件，且每个文件不超过{{maxSize}}M！\n        </div>\n      </template>\n\n    </el-upload>\n\n    <div style=\"text-align: center;margin-top: 20px\">\n      <el-button type=\"success\" style=\"font-size: 12px\" @click=\"submitUpload\">\n        上传\n      </el-button>\n    </div>\n  </div>\n</template>\n\n<script>\n  import upload from '../../utils/ajaxUpload';\n\n  export default {\n    props: {\n      isAdmin: {\n        type: Boolean,\n        default: false\n      },\n      prefix: {\n        type: String,\n        default: \"\"\n      },\n      listType: {\n        type: String,\n        default: \"picture\"\n      },\n      storeType: {\n        type: String,\n        default: localStorage.getItem(\"defaultStoreType\")\n      },\n      accept: {\n        type: String,\n        default: \"image/*\"\n      },\n      maxSize: {\n        type: Number,\n        default: 5\n      },\n      maxNumber: {\n        type: Number,\n        default: 5\n      }\n    },\n\n    data() {\n      return {}\n    },\n\n    computed: {},\n\n    watch: {},\n\n    created() {\n    },\n\n    mounted() {\n\n    },\n\n    methods: {\n      submitUpload() {\n        this.$refs.upload.submit();\n      },\n\n      customUpload(options) {\n        let suffix = \"\";\n        if (options.file.name.lastIndexOf('.') !== -1) {\n          suffix = options.file.name.substring(options.file.name.lastIndexOf('.'));\n        }\n\n        let key = this.prefix + \"/\" + (!this.$common.isEmpty(this.$store.state.currentUser.username) ? (this.$store.state.currentUser.username.replace(/[^a-zA-Z]/g, '') + this.$store.state.currentUser.id) : (this.$store.state.currentAdmin.username.replace(/[^a-zA-Z]/g, '') + this.$store.state.currentAdmin.id)) + new Date().getTime() + Math.floor(Math.random() * 1000) + suffix;\n\n        if (this.storeType === \"local\") {\n          let fd = new FormData();\n          fd.append(\"file\", options.file);\n          fd.append(\"originalName\", options.file.name);\n          fd.append(\"key\", key);\n          fd.append(\"relativePath\", key);\n          fd.append(\"type\", this.prefix);\n          fd.append(\"storeType\", this.storeType);\n\n          return this.$http.upload(\"http://47.96.86.223:8081/api\" + \"/resource/upload\", fd, this.isAdmin, options);\n        } else if (this.storeType === \"qiniu\") {\n          const xhr = new XMLHttpRequest();\n          xhr.open('get', \"http://47.96.86.223:8081/api\" + \"/qiniu/getUpToken?key=\" + key, false);\n          if (this.isAdmin) {\n            xhr.setRequestHeader(\"Authorization\", localStorage.getItem(\"adminToken\"));\n          } else {\n            xhr.setRequestHeader(\"Authorization\", localStorage.getItem(\"userToken\"));\n          }\n\n          try {\n            xhr.send();\n            const res = JSON.parse(xhr.responseText);\n            if (res !== null && res.hasOwnProperty(\"code\") && res.code === 200) {\n              options.data = {\n                token: res.data,\n                key: key\n              };\n              return upload(options);\n            } else if (res !== null && res.hasOwnProperty(\"code\") && res.code !== 200) {\n              return Promise.reject(res.message);\n            } else {\n              return Promise.reject(\"服务异常！\");\n            }\n          } catch (e) {\n            return Promise.reject(e.message);\n          }\n        }\n      },\n\n      // 文件上传成功时的钩子\n      handleSuccess(response, file, fileList) {\n        let url;\n        if (this.storeType === \"local\") {\n          url = response.data;\n        } else if (this.storeType === \"qiniu\") {\n          url = this.$store.state.sysConfig['qiniu.downloadUrl'] + response.key;\n          this.$common.saveResource(this, this.prefix, url, file.size, file.raw.type, file.name, \"qiniu\", this.isAdmin);\n        }\n        this.$emit(\"addPicture\", url);\n      },\n      handleError(err, file, fileList) {\n        this.$message({\n          message: err,\n          type: \"error\"\n        });\n      },\n      // 上传文件之前的钩子，参数为上传的文件，若返回 false 或者返回 Promise 且被 reject，则停止上传\n      beforeUpload(file) {\n      },\n      // 文件列表移除文件时的钩子\n      handleRemove(file, fileList) {\n      },\n      // 添加文件、上传成功和上传失败时都会被调用\n      handleChange(file, fileList) {\n        let flag = false;\n\n        if (file.size > this.maxSize * 1024 * 1024) {\n          this.$message({\n            message: \"图片最大为\" + this.maxSize + \"M！\",\n            type: \"warning\"\n          });\n          flag = true;\n        }\n\n        if (flag) {\n          fileList.splice(fileList.size - 1, 1);\n        }\n      }\n    }\n  }\n</script>\n\n<style scoped>\n\n</style>\n"]}]}